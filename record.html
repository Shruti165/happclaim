<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Complaint - HappyClaim</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="static/css/common.css">
    <link rel="stylesheet" href="static/css/navigation.css">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f9f9f9;
        }

        .content {
            padding: 20px;
            flex-grow: 1;
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .page-header h1 {
            color: #0c3057;
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .page-header p {
            color: #666;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .recording-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .input-method-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }

        .input-tab {
            padding: 15px 25px;
            cursor: pointer;
            color: #666;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 8px;
            flex: 1;
            text-align: center;
        }

        .input-tab:hover {
            background: rgba(12, 48, 87, 0.05);
        }

        .input-tab.active {
            color: #0c3057;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-tab i {
            margin-right: 8px;
            font-size: 1.2rem;
        }

        .voice-recording {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }

        .record-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #0c3057;
            border: none;
            color: white;
            font-size: 28px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto;
            box-shadow: 0 4px 6px rgba(12, 48, 87, 0.2);
        }

        .record-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(12, 48, 87, 0.3);
        }

        .record-button.recording {
            background: #dc3545;
            animation: pulse 1.5s infinite;
        }

        .recording-timer {
            font-size: 1.4rem;
            color: #0c3057;
            margin: 15px 0;
            font-weight: 600;
        }

        .text-input {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 20px 0;
        }

        .text-input textarea {
            width: 100%;
            min-height: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1.1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: white;
        }

        .text-input textarea:focus {
            border-color: #0c3057;
            box-shadow: 0 0 0 0.2rem rgba(12, 48, 87, 0.25);
        }

        .support-button {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            margin: 20px 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.2);
        }

        .support-button i {
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .support-button:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
        }

        .extracted-details {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .extracted-details h3 {
            color: #0c3057;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .extracted-details p {
            color: #666;
            margin-bottom: 20px;
        }

        .detail-item {
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .detail-label {
            font-weight: 600;
            color: #0c3057;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .detail-value {
            color: #666;
        }

        .detail-value input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .detail-value input:focus {
            border-color: #0c3057;
            box-shadow: 0 0 0 0.2rem rgba(12, 48, 87, 0.25);
        }

        .submit-button {
            background: #0c3057;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 30px;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 6px rgba(12, 48, 87, 0.2);
        }

        .submit-button:hover {
            background: #0a2540;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(12, 48, 87, 0.3);
        }

        .submit-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.4);
            }
            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }

        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }

            .page-header {
                padding: 15px;
            }

            .page-header h1 {
                font-size: 1.8rem;
            }

            .recording-container {
                padding: 20px;
            }

            .input-tab {
                padding: 12px 15px;
                font-size: 0.9rem;
            }

            .record-button {
                width: 80px;
                height: 80px;
                font-size: 24px;
            }

            .text-input textarea {
                min-height: 150px;
                padding: 15px;
            }

            .detail-value input {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <!-- Include Navigation -->
        <div id="navigation"></div>

        <div class="content">
            <div class="container">
                <div class="page-header">
                    <h1>Record Your Complaint</h1>
                    <p>Choose your preferred method to file your complaint</p>
                </div>

                <div class="recording-container">
                    <div class="input-method-tabs">
                        <div class="input-tab active" data-method="voice">
                            <i class="fas fa-microphone"></i>Voice Record
                        </div>
                        <div class="input-tab" data-method="text">
                            <i class="fas fa-keyboard"></i>Type Complaint
                        </div>
                    </div>

                    <div class="voice-recording" id="voiceInput">
                        <button class="record-button" id="recordButton">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <div class="recording-timer" id="recordingTimer">00:00</div>
                        <p>Click the button to start recording your complaint</p>
                    </div>

                    <div class="text-input" id="textInput" style="display: none;">
                        <textarea placeholder="Type your complaint details here..."></textarea>
                    </div>

                    <button class="support-button">
                        <i class="fas fa-headset"></i>Chat with Customer Support
                    </button>

                    <div class="extracted-details" id="extractedDetails" style="display: none;">
                        <h3>Extracted Details</h3>
                        <p>Please confirm the details extracted from your complaint:</p>
                        
                        <div class="detail-item">
                            <div class="detail-label">Category</div>
                            <div class="detail-value">
                                <input type="text" id="category" placeholder="E.g., E-commerce, Banking">
                            </div>
                        </div>

                        <div class="detail-item">
                            <div class="detail-label">Issue Description</div>
                            <div class="detail-value">
                                <input type="text" id="description" placeholder="Brief description of the issue">
                            </div>
                        </div>

                        <div class="detail-item">
                            <div class="detail-label">Amount Involved</div>
                            <div class="detail-value">
                                <input type="text" id="amount" placeholder="₹0">
                            </div>
                        </div>

                        <div class="detail-item">
                            <div class="detail-label">Date of Incident</div>
                            <div class="detail-value">
                                <input type="date" id="incidentDate">
                            </div>
                        </div>

                        <button class="submit-button">Submit Complaint</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            // Load navigation
            $("#navigation").load("static/navigation.html", function() {
                $('.nav-link[href="record.html"]').addClass('active');
            });

            // Handle input method tabs
            $('.input-tab').on('click', function() {
                $('.input-tab').removeClass('active');
                $(this).addClass('active');
                
                const method = $(this).data('method');
                if (method === 'voice') {
                    $('#voiceInput').show();
                    $('#textInput').hide();
                } else {
                    $('#voiceInput').hide();
                    $('#textInput').show();
                }
            });

            // Voice recording functionality
            let isRecording = false;
            let mediaRecorder;
            let audioChunks = [];
            let recordingTimer;
            let seconds = 0;

            $('#recordButton').on('click', function() {
                if (!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            });

            function startRecording() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(stream => {
                        mediaRecorder = new MediaRecorder(stream);
                        audioChunks = [];

                        mediaRecorder.ondataavailable = (event) => {
                            audioChunks.push(event.data);
                        };

                        mediaRecorder.onstop = () => {
                            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                            processAudio(audioBlob);
                        };

                        mediaRecorder.start();
                        isRecording = true;
                        $('#recordButton').addClass('recording');
                        startTimer();
                    })
                    .catch(error => {
                        console.error('Error accessing microphone:', error);
                        alert('Error accessing microphone. Please check your permissions.');
                    });
            }

            function stopRecording() {
                mediaRecorder.stop();
                isRecording = false;
                $('#recordButton').removeClass('recording');
                clearInterval(recordingTimer);
            }

            function startTimer() {
                seconds = 0;
                recordingTimer = setInterval(() => {
                    seconds++;
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    $('#recordingTimer').text(
                        `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`
                    );
                }, 1000);
            }

            // Process recorded audio or text input
            function processAudio(audioBlob) {
                // Simulate AI processing
                setTimeout(() => {
                    extractDetails();
                }, 1500);
            }

            $('.text-input textarea').on('input', function() {
                // Simulate AI processing after user stops typing
                clearTimeout(this.typingTimer);
                this.typingTimer = setTimeout(() => {
                    const text = $(this).val();
                    if (text.length > 10) { // Only process if there's enough text
                        extractDetailsFromText(text);
                    }
                }, 1000);
            });

            function extractDetailsFromText(text) {
                // Initialize extracted details
                let category = '';
                let description = '';
                let amount = '';
                let date = '';

                // Extract category
                const categoryKeywords = {
                    'e-commerce': ['amazon', 'flipkart', 'myntra', 'online', 'delivery', 'product'],
                    'banking': ['bank', 'account', 'transaction', 'atm', 'card', 'loan'],
                    'telecom': ['mobile', 'phone', 'sim', 'network', 'data', 'call'],
                    'insurance': ['insurance', 'policy', 'claim', 'coverage', 'premium']
                };

                for (const [cat, keywords] of Object.entries(categoryKeywords)) {
                    if (keywords.some(keyword => text.toLowerCase().includes(keyword))) {
                        category = cat.charAt(0).toUpperCase() + cat.slice(1);
                        break;
                    }
                }

                // Extract amount
                const amountRegex = /₹\s*(\d+(?:,\d+)*(?:\.\d+)?)/i;
                const amountMatch = text.match(amountRegex);
                if (amountMatch) {
                    amount = amountMatch[0];
                }

                // Extract date
                const dateRegex = /(\d{1,2})[-/](\d{1,2})[-/](\d{4})/;
                const dateMatch = text.match(dateRegex);
                if (dateMatch) {
                    const [_, day, month, year] = dateMatch;
                    date = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                }

                // Extract description
                // Remove amount and date from text to get description
                let descriptionText = text
                    .replace(amountRegex, '')
                    .replace(dateRegex, '')
                    .trim();

                // Find the first sentence or up to 100 characters
                const firstSentence = descriptionText.match(/[^.!?]+[.!?]+/);
                description = firstSentence ? firstSentence[0].trim() : descriptionText.substring(0, 100);

                // Update the form with extracted details
                $('#category').val(category);
                $('#description').val(description);
                $('#amount').val(amount);
                $('#incidentDate').val(date);

                // Show the extracted details section
                $('#extractedDetails').slideDown();
            }

            function extractDetails() {
                // Get the current input method
                const isVoice = $('#voiceInput').is(':visible');
                const text = isVoice ? '' : $('.text-input textarea').val();

                if (isVoice) {
                    // Simulate voice processing
                    $('#extractedDetails').slideDown();
                    $('#category').val('E-commerce');
                    $('#description').val('Delayed delivery and damaged product');
                    $('#amount').val('₹15,000');
                    $('#incidentDate').val('2024-04-20');
                } else if (text.length > 10) {
                    extractDetailsFromText(text);
                }
            }

            // Handle complaint submission
            $('.submit-button').on('click', function() {
                // Validate the form
                const category = $('#category').val();
                const description = $('#description').val();
                const amount = $('#amount').val();
                const incidentDate = $('#incidentDate').val();

                if (!category || !description || !amount || !incidentDate) {
                    alert('Please fill in all required fields');
                    return;
                }

                // Validate amount format
                if (!amount.match(/^₹\s*\d+(?:,\d+)*(?:\.\d+)?$/)) {
                    alert('Please enter a valid amount in the format ₹XX,XXX');
                    return;
                }

                // Validate date
                const date = new Date(incidentDate);
                if (isNaN(date.getTime())) {
                    alert('Please enter a valid date');
                    return;
                }

                // Prepare complaint data
                const complaintData = {
                    category,
                    description,
                    amount,
                    incidentDate
                };

                // Simulate submission
                alert('Complaint submitted successfully!');
                window.location.href = 'complaint-history.html';
            });

            // Handle customer support chat
            $('.support-button').on('click', function() {
                // Implement chat functionality
                alert('Connecting to customer support...');
            });
        });
    </script>
</body>
</html> 